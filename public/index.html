<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ å¯†è´§å¸äº¤æ˜“åˆ†æç³»ç»Ÿ - æ¼”ç¤º</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
            text-align: center;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            margin: 5px;
        }
        .status.connected { background-color: #4CAF50; }
        .status.disconnected { background-color: #f44336; }
        .price-card {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin: 10px;
            border-radius: 10px;
            min-width: 200px;
            text-align: center;
        }
        .price-symbol {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .price-value {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .price-change {
            font-size: 14px;
        }
        .signal-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        .signal-bullish {
            border-color: #4CAF50;
            background-color: #f8fff8;
        }
        .signal-bearish {
            border-color: #f44336;
            background-color: #fff8f8;
        }
        .signal-neutral {
            border-color: #ff9800;
            background-color: #fffaf0;
        }
        .arbitrage-card {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
        }
        .log-area {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2980b9;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .timestamp {
            color: #7f8c8d;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ åŠ å¯†è´§å¸äº¤æ˜“åˆ†æç³»ç»Ÿ</h1>
        <div style="text-align: center;">
            <span id="connectionStatus" class="status disconnected">æœªè¿æ¥</span>
            <span class="timestamp" id="lastUpdate">æœ€åæ›´æ–°: --</span>
        </div>
        
        <div class="controls">
            <button onclick="connectSocket()">è¿æ¥æœåŠ¡å™¨</button>
            <button onclick="disconnectSocket()">æ–­å¼€è¿æ¥</button>
            <button onclick="subscribeSymbols()">è®¢é˜…ä»·æ ¼</button>
            <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <div class="grid">
        <div class="container">
            <h2>ğŸ’° å®æ—¶ä»·æ ¼</h2>
            <div id="pricesContainer">
                <p>ç­‰å¾…ä»·æ ¼æ•°æ®...</p>
            </div>
        </div>

        <div class="container">
            <h2>ğŸ“Š äº¤æ˜“ä¿¡å·</h2>
            <div id="signalsContainer">
                <p>ç­‰å¾…ä¿¡å·æ•°æ®...</p>
            </div>
        </div>

        <div class="container">
            <h2>ğŸ”„ å¥—åˆ©æœºä¼š</h2>
            <div id="arbitrageContainer">
                <p>ç­‰å¾…å¥—åˆ©æ•°æ®...</p>
            </div>
        </div>

        <div class="container">
            <h2>ğŸ“ˆ æŠ€æœ¯æŒ‡æ ‡</h2>
            <div id="indicatorsContainer">
                <p>ç­‰å¾…æŒ‡æ ‡æ•°æ®...</p>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ“ å®æ—¶æ—¥å¿—</h2>
        <div id="logArea" class="log-area"></div>
    </div>

    <script>
        let socket = null;
        let isConnected = false;

        // ç›‘æ§çš„äº¤æ˜“å¯¹
        const watchedSymbols = ['BTC/USDT', 'ETH/USDT', 'BNB/USDT'];

        function addLog(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.innerHTML += `[${timestamp}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        function updateConnectionStatus(connected) {
            isConnected = connected;
            const status = document.getElementById('connectionStatus');
            status.className = `status ${connected ? 'connected' : 'disconnected'}`;
            status.textContent = connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥';
            
            if (connected) {
                addLog('âœ… å·²è¿æ¥åˆ°æœåŠ¡å™¨');
            } else {
                addLog('âŒ ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥');
            }
        }

        function connectSocket() {
            if (socket && isConnected) {
                addLog('âš ï¸ å·²ç»è¿æ¥åˆ°æœåŠ¡å™¨');
                return;
            }

            try {
                socket = io('http://localhost:3000');
                
                socket.on('connect', () => {
                    updateConnectionStatus(true);
                    subscribeSymbols();
                });

                socket.on('disconnect', () => {
                    updateConnectionStatus(false);
                });

                socket.on('price_update', (data) => {
                    addLog(`ğŸ’° ä»·æ ¼æ›´æ–°: ${Object.keys(data.prices).length} ä¸ªäº¤æ˜“å¯¹`);
                    updatePricesDisplay(data.prices);
                    updateLastUpdateTime();
                });

                socket.on('indicators_update', (data) => {
                    addLog(`ğŸ“Š æŒ‡æ ‡æ›´æ–°: ${data.symbol}`);
                    updateIndicatorsDisplay(data.symbol, data.indicators);
                });

                socket.on('arbitrage_opportunities', (data) => {
                    addLog(`ğŸ”„ å‘ç° ${data.opportunities.length} ä¸ªå¥—åˆ©æœºä¼š`);
                    updateArbitrageDisplay(data.opportunities);
                });

                socket.on('price_alert', (data) => {
                    addLog(`âš ï¸ ä»·æ ¼é¢„è­¦: ${data.symbol} ${data.type} ${data.targetPrice}`);
                });

                socket.on('price_anomaly', (data) => {
                    addLog(`ğŸš¨ å¼‚å¸¸æ£€æµ‹: ${data.symbol} å‡ºç° ${data.type} (Z-score: ${data.zScore})`);
                });

                addLog('ğŸ”„ æ­£åœ¨è¿æ¥æœåŠ¡å™¨...');
            } catch (error) {
                addLog(`âŒ è¿æ¥å¤±è´¥: ${error.message}`);
            }
        }

        function disconnectSocket() {
            if (socket) {
                socket.disconnect();
                socket = null;
                updateConnectionStatus(false);
            }
        }

        function subscribeSymbols() {
            if (socket && isConnected) {
                socket.emit('subscribe', { symbols: watchedSymbols });
                addLog(`ğŸ“º è®¢é˜…äº¤æ˜“å¯¹: ${watchedSymbols.join(', ')}`);
            }
        }

        function clearLogs() {
            document.getElementById('logArea').innerHTML = '';
        }

        function updateLastUpdateTime() {
            document.getElementById('lastUpdate').textContent = 
                `æœ€åæ›´æ–°: ${new Date().toLocaleTimeString()}`;
        }

        function updatePricesDisplay(prices) {
            const container = document.getElementById('pricesContainer');
            container.innerHTML = '';

            Object.entries(prices).forEach(([symbol, exchangePrices]) => {
                if (!exchangePrices) return;

                const binancePrice = exchangePrices.binance;
                if (binancePrice) {
                    const priceCard = document.createElement('div');
                    priceCard.className = 'price-card';
                    
                    const changePercent = binancePrice.percentage || 0;
                    const changeColor = changePercent >= 0 ? '#4CAF50' : '#f44336';
                    
                    priceCard.innerHTML = `
                        <div class="price-symbol">${symbol}</div>
                        <div class="price-value">$${Number(binancePrice.price).toLocaleString()}</div>
                        <div class="price-change" style="color: ${changeColor}">
                            ${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%
                        </div>
                    `;
                    
                    container.appendChild(priceCard);
                }
            });
        }

        function updateIndicatorsDisplay(symbol, indicators) {
            const container = document.getElementById('indicatorsContainer');
            
            // åˆ›å»ºæˆ–æ›´æ–°æŒ‡æ ‡æ˜¾ç¤º
            let indicatorCard = document.getElementById(`indicator-${symbol}`);
            if (!indicatorCard) {
                indicatorCard = document.createElement('div');
                indicatorCard.id = `indicator-${symbol}`;
                indicatorCard.className = 'signal-card';
                container.appendChild(indicatorCard);
            }

            const rsi = indicators.rsi ? indicators.rsi[indicators.rsi.length - 1] : null;
            const macd = indicators.macd ? indicators.macd.histogram[indicators.macd.histogram.length - 1] : null;

            indicatorCard.innerHTML = `
                <h3>${symbol} æŠ€æœ¯æŒ‡æ ‡</h3>
                <p><strong>RSI (14):</strong> ${rsi ? rsi.toFixed(2) : 'N/A'}</p>
                <p><strong>MACDæŸ±çŠ¶å›¾:</strong> ${macd ? macd.toFixed(6) : 'N/A'}</p>
                <p><strong>ä¿¡å·:</strong> ${indicators.signals.overall}</p>
                <p><strong>å¼ºåº¦:</strong> ${(indicators.signals.strength * 100).toFixed(1)}%</p>
            `;
        }

        function updateSignalsDisplay(signals) {
            const container = document.getElementById('signalsContainer');
            container.innerHTML = '';

            signals.forEach(signal => {
                const signalCard = document.createElement('div');
                signalCard.className = `signal-card signal-${signal.overall.toLowerCase()}`;
                
                signalCard.innerHTML = `
                    <h3>${signal.symbol}</h3>
                    <p><strong>ä¿¡å·:</strong> ${signal.overall}</p>
                    <p><strong>å¼ºåº¦:</strong> ${(signal.strength * 100).toFixed(1)}%</p>
                    <p><strong>å»ºè®®:</strong> ${signal.action || 'è§‚æœ›'}</p>
                `;
                
                container.appendChild(signalCard);
            });
        }

        function updateArbitrageDisplay(opportunities) {
            const container = document.getElementById('arbitrageContainer');
            container.innerHTML = '';

            if (opportunities.length === 0) {
                container.innerHTML = '<p>æš‚æ— å¥—åˆ©æœºä¼š</p>';
                return;
            }

            opportunities.slice(0, 5).forEach(opp => {
                const arbCard = document.createElement('div');
                arbCard.className = 'arbitrage-card';
                
                arbCard.innerHTML = `
                    <h4>${opp.symbol}</h4>
                    <p><strong>ä¹°å…¥:</strong> ${opp.buyExchange} @ $${Number(opp.buyPrice).toLocaleString()}</p>
                    <p><strong>å–å‡º:</strong> ${opp.sellExchange} @ $${Number(opp.sellPrice).toLocaleString()}</p>
                    <p><strong>ä»·å·®:</strong> ${opp.percentage}%</p>
                `;
                
                container.appendChild(arbCard);
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿æ¥
        window.onload = function() {
            addLog('ğŸŒ é¡µé¢å·²åŠ è½½ï¼Œå‡†å¤‡è¿æ¥æœåŠ¡å™¨');
            // å»¶è¿Ÿ1ç§’åè‡ªåŠ¨è¿æ¥ï¼Œç¡®ä¿æœåŠ¡å™¨å·²å¯åŠ¨
            setTimeout(connectSocket, 1000);
        };

        // é¡µé¢å…³é—­å‰æ–­å¼€è¿æ¥
        window.onbeforeunload = function() {
            if (socket) {
                socket.disconnect();
            }
        };
    </script>
</body>
</html>
